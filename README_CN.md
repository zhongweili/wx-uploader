# wx-uploader

ä¸€ä¸ªç”¨äºä¸Šä¼  Markdown æ–‡ä»¶åˆ°å¾®ä¿¡å…¬ä¼—å·çš„å‘½ä»¤è¡Œå·¥å…·ï¼Œæ”¯æŒå¤šè´¦å·ç®¡ç†å’Œ AI è‡ªåŠ¨ç”Ÿæˆå°é¢å›¾ç‰‡ã€‚

## å®‰è£…

ä» crates.io ç›´æ¥å®‰è£…ï¼š

```bash
cargo install wx-uploader
```

æˆ–ä»æºç æ„å»ºï¼š

```bash
git clone https://github.com/tyrchen/wx-uploader.git
cd wx-uploader
cargo install --path .
```

## å‰ç½®æ¡ä»¶

æ‚¨å¯ä»¥é€šè¿‡ä¸¤ç§æ–¹å¼é…ç½® wx-uploaderï¼šç¯å¢ƒå˜é‡ï¼ˆå•è´¦å·ï¼‰æˆ–é…ç½®æ–‡ä»¶ï¼ˆå¤šè´¦å·ï¼‰ã€‚

### æ–¹å¼ä¸€ï¼šç¯å¢ƒå˜é‡ï¼ˆå•è´¦å·ï¼‰

```bash
# å¿…éœ€ï¼šå¾®ä¿¡å…¬ä¼—å·å‡­è¯
export WECHAT_APP_ID="your_app_id"
export WECHAT_APP_SECRET="your_app_secret"

# å¯é€‰ï¼šAI æä¾›å•†é…ç½®ï¼Œç”¨äºè‡ªåŠ¨ç”Ÿæˆå°é¢å›¾
# é€‰é¡¹ 1ï¼šOpenAIï¼ˆé»˜è®¤ï¼‰
export OPENAI_API_KEY="your_openai_api_key"

# é€‰é¡¹ 2ï¼šGoogle Geminiï¼ˆæ”¯æŒæ–‡æœ¬å’Œå›¾åƒç”Ÿæˆï¼‰
export AI_PROVIDER="gemini"
export GEMINI_API_KEY="your_gemini_api_key"
```

### æ–¹å¼äºŒï¼šé…ç½®æ–‡ä»¶ï¼ˆå¤šè´¦å·æ”¯æŒï¼‰

åˆ›å»ºé…ç½®æ–‡ä»¶æ¥ç®¡ç†å¤šä¸ªå¾®ä¿¡å…¬ä¼—å·ï¼š

```bash
# ç”Ÿæˆç¤ºä¾‹é…ç½®æ–‡ä»¶
wx-uploader --init-config config.yaml
```

è¿™ä¼šåˆ›å»ºä¸€ä¸ªé…ç½®æ–‡ä»¶ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š

```yaml
# ç¤ºä¾‹é…ç½®æ–‡ä»¶
accounts:
  personal:
    name: "personal"
    app_id: "your_personal_app_id_here"
    app_secret: "your_personal_app_secret_here"
    description: "ä¸ªäººå¾®ä¿¡å…¬ä¼—å·"
  
  work:
    name: "work"
    app_id: "your_work_app_id_here"
    app_secret: "your_work_app_secret_here"
    description: "å·¥ä½œå¾®ä¿¡å…¬ä¼—å·"

default_account: "personal"

ai_provider:
  provider: "openai"  # æˆ– "gemini"
  openai:
    api_key: "your_openai_api_key_here"
  gemini:
    api_key: "your_gemini_api_key_here"

settings:
  verbose: false
```

## ä½¿ç”¨æ–¹æ³•

### åŸºç¡€ä½¿ç”¨ï¼ˆå•è´¦å·ï¼‰

```bash
# ä¸Šä¼ æ‰€æœ‰ frontmatter ä¸­æ²¡æœ‰ `published: true` çš„ .md æ–‡ä»¶
wx-uploader .

# ä»æŒ‡å®šç›®å½•ä¸Šä¼ 
wx-uploader ./posts

# å¯ç”¨è¯¦ç»†è¾“å‡º
wx-uploader --verbose ./posts

# ä½¿ç”¨æŒ‡å®šçš„ AI æä¾›å•†
wx-uploader --provider gemini ./posts

# ä½¿ç”¨è‡ªå®šä¹‰ AI API å¯†é’¥
wx-uploader --ai-key your_custom_key ./posts
```

### å¤šè´¦å·ä½¿ç”¨

```bash
# åˆ—å‡ºé…ç½®æ–‡ä»¶ä¸­çš„å¯ç”¨è´¦å·
wx-uploader --config config.yaml --list-accounts

# ä½¿ç”¨é…ç½®æ–‡ä»¶ä¸­çš„æŒ‡å®šè´¦å·ä¸Šä¼ 
wx-uploader --config config.yaml --account work ./posts

# ä½¿ç”¨é»˜è®¤è´¦å·ä¸Šä¼ 
wx-uploader --config config.yaml ./posts

# ä¸ºæ­¤æ¬¡ä¸Šä¼ è¦†ç›– AI æä¾›å•†
wx-uploader --config config.yaml --provider gemini --account personal ./posts
```

### ä¸Šä¼ æŒ‡å®šæ–‡ä»¶

```bash
# å¼ºåˆ¶ä¸Šä¼ æŒ‡å®šæ–‡ä»¶ï¼ˆå¿½ç•¥å‘å¸ƒçŠ¶æ€ï¼‰
wx-uploader ./2025/08/01-chat-with-ai.md

# ä½¿ç”¨å¤šè´¦å·é…ç½®ä¸Šä¼ æŒ‡å®šæ–‡ä»¶
wx-uploader --config config.yaml --account work ./article.md
```

### å‘½ä»¤è¡Œé€‰é¡¹

```bash
wx-uploader [é€‰é¡¹] [è·¯å¾„]

é€‰é¡¹:
    -c, --config <æ–‡ä»¶>        é…ç½®æ–‡ä»¶è·¯å¾„ï¼ˆYAML æˆ– JSONï¼‰
    -a, --account <åç§°>       ä½¿ç”¨é…ç½®æ–‡ä»¶ä¸­çš„è´¦å·åç§°
    -p, --provider <æä¾›å•†>    AI æä¾›å•†ï¼šopenai, gemini [é»˜è®¤: openai]
        --ai-key <å¯†é’¥>        AI API å¯†é’¥ï¼ˆè¦†ç›–é…ç½®/ç¯å¢ƒå˜é‡ï¼‰
    -v, --verbose              å¯ç”¨è¯¦ç»†è¾“å‡º
        --list-accounts        åˆ—å‡ºé…ç½®æ–‡ä»¶ä¸­çš„å¯ç”¨è´¦å·
        --init-config <æ–‡ä»¶>   ç”Ÿæˆç¤ºä¾‹é…ç½®æ–‡ä»¶
    -h, --help                 æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯
    -V, --version              æ˜¾ç¤ºç‰ˆæœ¬ä¿¡æ¯
```

## å·¥ä½œåŸç†

1. å·¥å…·æ‰«æå¸¦æœ‰ YAML frontmatter çš„ Markdown æ–‡ä»¶
2. å¦‚æœæ–‡ä»¶çš„ frontmatter ä¸­æ²¡æœ‰ `published: true`ï¼Œåˆ™ä¼šè¢«ä¸Šä¼ 
3. å¦‚æœæ²¡æœ‰æŒ‡å®šå°é¢å›¾ç‰‡ä¸”é…ç½®äº† OpenAI API å¯†é’¥ï¼Œå°†ä½¿ç”¨ GPT-5 å’Œ gpt-image-1 ç”Ÿæˆå‰åœåŠ›é£æ ¼çš„å°é¢å›¾
4. æŒ‡å®šå•ä¸ªæ–‡ä»¶æ—¶ï¼Œæ— è®ºå…¶å‘å¸ƒçŠ¶æ€å¦‚ä½•éƒ½ä¼šè¢«ä¸Šä¼ 
5. ä¸Šä¼ æˆåŠŸåï¼Œfrontmatter ä¼šæ›´æ–°ä¸º `published: draft` å¹¶åŒ…å«ç”Ÿæˆçš„å°é¢æ–‡ä»¶åï¼ˆå¦‚æœæœ‰ï¼‰

## Frontmatter ç¤ºä¾‹

```yaml
---
title: æˆ‘çš„æ–‡ç« æ ‡é¢˜
published: draft  # æˆ– 'true' ä»¥è·³è¿‡ä¸Šä¼ 
cover: cover.png  # å¯é€‰ï¼Œå¦‚æœç¼ºå¤±ä¸”è®¾ç½®äº† OpenAI å¯†é’¥åˆ™è‡ªåŠ¨ç”Ÿæˆ
description: æ–‡ç« æè¿°
author: ä½œè€…å§“å
theme: lapis  # å¯é€‰ä¸»é¢˜
---

æ‚¨çš„ Markdown å†…å®¹åœ¨è¿™é‡Œ...
```

## AI å°é¢ç”Ÿæˆ

å½“è®¾ç½®äº† `OPENAI_API_KEY` ç¯å¢ƒå˜é‡æ—¶ï¼Œå·¥å…·ä¼šä¸ºæ²¡æœ‰æŒ‡å®šå°é¢çš„æ–‡ç« è‡ªåŠ¨ç”Ÿæˆç²¾ç¾çš„å°é¢å›¾ç‰‡ã€‚

### å·¥ä½œåŸç†ï¼š

1. **å†…å®¹åˆ†æ**ï¼šGPT-5-mini åˆ†ææ‚¨çš„ Markdown å†…å®¹ä»¥åˆ›å»ºç”ŸåŠ¨çš„åœºæ™¯æè¿°
2. **æç¤ºè¯ç”Ÿæˆ**ï¼šåˆ›å»ºä¼˜åŒ–çš„æç¤ºè¯ï¼Œä¸“æ³¨äºå‰åœåŠ›é£æ ¼çš„è‰ºæœ¯ä½œå“
3. **å›¾åƒç”Ÿæˆ**ï¼šgpt-image-1 ç”Ÿæˆé«˜è´¨é‡çš„ 16:9 å®½é«˜æ¯”å°é¢å›¾ç‰‡
4. **è‡ªåŠ¨ä¿å­˜**ï¼šä¸‹è½½å¹¶ä¿å­˜å›¾ç‰‡åˆ°ä¸ Markdown æ–‡ä»¶ç›¸åŒçš„ç›®å½•
5. **å…ƒæ•°æ®æ›´æ–°**ï¼šä½¿ç”¨ç”Ÿæˆçš„å°é¢æ–‡ä»¶åæ›´æ–° frontmatter

### ç‰¹æ€§ï¼š

- **å‰åœåŠ›é£æ ¼**ï¼šç¾ä¸½çš„è‰ºæœ¯ç¾å­¦ï¼ŒæŸ”å’Œçš„è‰²å½©å’Œè‡ªç„¶å…ƒç´ 
- **å†…å®¹æ„ŸçŸ¥**ï¼šåœºæ™¯æè¿°åŸºäºæ‚¨çš„å®é™…æ–‡ç« å†…å®¹
- **é«˜è´¨é‡**ï¼š1536x1024 åˆ†è¾¨ç‡ï¼Œä¼˜åŒ–ç”¨äºç½‘é¡µæ˜¾ç¤º
- **è‡ªåŠ¨å‘½å**ï¼šç”Ÿæˆçš„æ–‡ä»¶ä½¿ç”¨å”¯ä¸€åç§°ä»¥é˜²æ­¢å†²çª
- **ä¼˜é›…é™çº§**ï¼šå¦‚æœå›¾åƒç”Ÿæˆå¤±è´¥ï¼Œç»§ç»­æ­£å¸¸ä¸Šä¼ æµç¨‹
- **Base64 æ”¯æŒ**ï¼šåŒæ—¶å¤„ç† URL å’Œ base64 ç¼–ç çš„å›¾åƒå“åº”

### è¾“å‡ºç¤ºä¾‹ï¼š

å¯¹äºä¸€ç¯‡å…³äº"æ„å»º Rust åº”ç”¨ç¨‹åº"çš„æ–‡ç« ï¼ŒAI å¯èƒ½ä¼šç”Ÿæˆè¿™æ ·çš„åœºæ™¯ï¼š
> "ä¸€ä¸ªèˆ’é€‚çš„å·¥ä½œåŠï¼Œå……æ»¡äº†ç²¾è‡´çš„é½¿è½®å’Œå‘å…‰çš„æœºæ¢°å·¥å…·ï¼Œå·¥åŒ æ­£åœ¨ä»”ç»†ç»„è£…å‘æ¡è£…ç½®ã€‚æ¸©æš–çš„é‡‘è‰²å…‰çº¿é€è¿‡é«˜çª—æ´’è¿›æ¥ï¼Œç…§äº®äº†åƒè¤ç«è™«ä¸€æ ·åœ¨å°˜åŸƒä¸­é—ªçƒçš„æ¼‚æµ®é”ˆç²’å­ã€‚"

è¿™ä¼šå˜æˆä¸€å¹…ç¾ä¸½çš„å‰åœåŠ›é£æ ¼å°é¢å›¾ç‰‡ï¼Œè§†è§‰åŒ–åœ°å‘ˆç°æ‚¨çš„å†…å®¹ã€‚

## åŠŸèƒ½ç‰¹æ€§

- ğŸ“ **æ‰¹é‡ä¸Šä¼ **ï¼šå¤„ç†æ•´ä¸ªç›®å½•çš„ Markdown æ–‡ä»¶
- ğŸ¨ **AI å°é¢ç”Ÿæˆ**ï¼šä½¿ç”¨ OpenAI æœ€æ–°æ¨¡å‹è‡ªåŠ¨ç”Ÿæˆå°é¢å›¾ç‰‡
- ğŸ”„ **æ™ºèƒ½å¤„ç†**ï¼šè·³è¿‡å·²å‘å¸ƒçš„æ–‡ç« 
- ğŸ“Š **è¿›åº¦è·Ÿè¸ª**ï¼šå¸¦æœ‰å½©è‰²çŠ¶æ€æŒ‡ç¤ºå™¨çš„æ¸…æ™°æ§åˆ¶å°è¾“å‡º
- ğŸ›¡ï¸ **é”™è¯¯æ¢å¤**ï¼šä¼˜é›…åœ°å¤„ç† API å¤±è´¥
- ğŸ” **å®‰å…¨**ï¼šAPI å¯†é’¥ä»…å­˜å‚¨åœ¨ç¯å¢ƒå˜é‡ä¸­

## å¼€å‘

### è¿è¡Œæµ‹è¯•

é¡¹ç›®åŒ…å«å…¨é¢çš„å•å…ƒæµ‹è¯•å’Œé›†æˆæµ‹è¯•ï¼š

```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
cargo test

# å¸¦è¾“å‡ºè¿è¡Œæµ‹è¯•
cargo test -- --nocapture

# è¿è¡Œç‰¹å®šæµ‹è¯•æ¨¡å—
cargo test test_frontmatter

# ä»…è¿è¡Œé›†æˆæµ‹è¯•
cargo test --test integration_tests
```

### ä»£ç è´¨é‡

```bash
# è¿è¡Œ clippy è¿›è¡Œä»£ç æ£€æŸ¥
cargo clippy --all-targets --all-features

# æ£€æŸ¥å®‰å…¨æ¼æ´
cargo audit

# æ ¼å¼åŒ–ä»£ç 
cargo fmt

# ç”Ÿæˆæ–‡æ¡£
cargo doc --open
```

### é¡¹ç›®ç»“æ„

```
wx-uploader/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ main.rs          # CLI å…¥å£ç‚¹
â”‚   â”œâ”€â”€ lib.rs           # å…¬å…± API
â”‚   â”œâ”€â”€ cli.rs           # å‘½ä»¤è¡Œæ¥å£
â”‚   â”œâ”€â”€ error.rs         # é”™è¯¯å¤„ç†
â”‚   â”œâ”€â”€ models.rs        # æ•°æ®ç»“æ„
â”‚   â”œâ”€â”€ markdown.rs      # Markdown è§£æ
â”‚   â”œâ”€â”€ openai.rs        # AI é›†æˆ
â”‚   â”œâ”€â”€ output.rs        # æ§åˆ¶å°è¾“å‡ºæ ¼å¼åŒ–
â”‚   â””â”€â”€ wechat.rs        # å¾®ä¿¡ API é›†æˆ
â””â”€â”€ tests/
    â””â”€â”€ integration_tests.rs  # é›†æˆæµ‹è¯•
```

## æ³¨æ„äº‹é¡¹

- ç›®å½•æ‰«ææ—¶ä¼šè·³è¿‡å¸¦æœ‰ `published: true` çš„æ–‡ä»¶
- å•æ–‡ä»¶ä¸Šä¼ æ€»æ˜¯å¼ºåˆ¶ä¸Šä¼ ï¼Œæ— è®ºå‘å¸ƒçŠ¶æ€å¦‚ä½•
- å·¥å…·åœ¨æ›´æ–°æ—¶ä¼šä¿ç•™æ‰€æœ‰å…¶ä»– frontmatter å­—æ®µ
- å°é¢å›¾ç‰‡ä¿å­˜åœ¨ä¸ Markdown æ–‡ä»¶ç›¸åŒçš„ç›®å½•ä¸­
- æ”¯æŒ published å­—æ®µçš„å­—ç¬¦ä¸²ï¼ˆ`"true"`ï¼‰å’Œå¸ƒå°”å€¼ï¼ˆ`true`ï¼‰æ ¼å¼
- é…ç½®æ–‡ä»¶æ”¯æŒ YAMLï¼ˆ`.yaml`, `.yml`ï¼‰å’Œ JSONï¼ˆ`.json`ï¼‰æ ¼å¼
- è´¦å·åˆ‡æ¢æ— ç¼ï¼Œæ— éœ€é‡å¯å·¥å…·

## é…ç½®ä¼˜å…ˆçº§

å·¥å…·æŒ‰ä»¥ä¸‹ä¼˜å…ˆçº§é¡ºåºè¿›è¡Œé…ç½®ï¼š

1. **å‘½ä»¤è¡Œæ ‡å¿—**ï¼ˆæœ€é«˜ä¼˜å…ˆçº§ï¼‰ï¼š`--provider`ã€`--ai-key`ã€`--verbose`
2. **é…ç½®æ–‡ä»¶**ï¼šæ¥è‡ª `--config` æ–‡ä»¶çš„è®¾ç½®
3. **ç¯å¢ƒå˜é‡**ï¼š`WECHAT_APP_ID`ã€`OPENAI_API_KEY` ç­‰
4. **é»˜è®¤å€¼**ï¼ˆæœ€ä½ä¼˜å…ˆçº§ï¼‰

## å¤šè´¦å·å·¥ä½œæµç¨‹

### è®¾ç½®å·¥ä½œæµç¨‹
```bash
# 1. ç”Ÿæˆé…ç½®æ¨¡æ¿
wx-uploader --init-config my-accounts.yaml

# 2. ç¼–è¾‘æ–‡ä»¶ï¼Œå¡«å…¥æ‚¨çš„å®é™…å‡­è¯
# å°†å ä½ç¬¦å€¼æ›¿æ¢ä¸ºçœŸå®çš„ app_idã€app_secret å’Œ API å¯†é’¥

# 3. åˆ—å‡ºé…ç½®çš„è´¦å·
wx-uploader --config my-accounts.yaml --list-accounts

# 4. ä½¿ç”¨æŒ‡å®šè´¦å·æµ‹è¯•ä¸Šä¼ 
wx-uploader --config my-accounts.yaml --account personal ./test-article.md
```

### æ—¥å¸¸ä½¿ç”¨å·¥ä½œæµç¨‹
```bash
# ä¸Šä¼ ä¸ªäººåšå®¢æ–‡ç« 
wx-uploader --config my-accounts.yaml --account personal ./blog/

# ä½¿ç”¨ä¸åŒçš„ AI æä¾›å•†ä¸Šä¼ å·¥ä½œæ–‡ç« 
wx-uploader --config my-accounts.yaml --account work --provider gemini ./work-posts/

# ä½¿ç”¨é»˜è®¤è´¦å·å¿«é€Ÿä¸Šä¼ 
wx-uploader --config my-accounts.yaml ./quick-post.md
```

## è®¸å¯è¯

MIT

## è´¡çŒ®

æ¬¢è¿è´¡çŒ®ï¼è¯·éšæ—¶æäº¤ Pull Requestã€‚
